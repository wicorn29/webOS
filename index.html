<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simple Desktop</title>
<link rel="stylesheet" href="https://raw.githubusercontent.com/wicorn29/webOS/main/asset/style.css">
<style>
  /* Additional CSS styling specific to this HTML file can be added here */
</style>
</head>
<body>
<div id="desktop">
  <div class="icon" id="icon1" style="left: 50px; top: 50px;">
    <div class="icon-name" contenteditable="true">Icon 1</div>
  </div>
  <div class="icon" id="icon2" style="left: 150px; top: 100px;">
    <div class="icon-name" contenteditable="true">Icon 2</div>
  </div>
</div>
<div id="text-editor">
  <textarea id="editor-content"></textarea>
  <button id="save-button">Save</button>
</div>
<div class="context-menu" id="desktop-context-menu">
  <div class="context-menu-item" id="add-icon">Add Icon</div>
</div>
<div id="trash-can">
  <div class="icon-name" contenteditable="false">Trash</div>
</div>
<script>
  const desktop = document.getElementById('desktop');
  const contextMenu = document.getElementById('desktop-context-menu');
  const addIconMenuItem = document.getElementById('add-icon');
  const trashCan = document.getElementById('trash-can');
  const icons = document.querySelectorAll('.icon');
  const textEditor = document.getElementById('text-editor');
  const editorContent = document.getElementById('editor-content');
  const saveButton = document.getElementById('save-button');

  // Load icon positions and names from cookies
  icons.forEach(icon => {
    const savedLeft = getCookie(`${icon.id}-left`);
    const savedTop = getCookie(`${icon.id}-top`);
    const savedName = getCookie(`${icon.id}-name`);
    if (savedLeft && savedTop) {
      icon.style.left = savedLeft;
      icon.style.top = savedTop;
    }
    const iconName = icon.querySelector('.icon-name');
    if (savedName) {
      iconName.textContent = savedName;
    }
    icon.addEventListener('mousedown', startDrag);
    iconName.addEventListener('dblclick', startEdit);
    iconName.addEventListener('blur', endEdit);
  });

  // Load text editor content from cookies
  editorContent.value = getCookie('editor-content');

  // Text editor save button
  saveButton.addEventListener('click', () => {
    setCookie('editor-content', editorContent.value);
    alert('Text saved!');
  });

  // Context menu event listener
  desktop.addEventListener('contextmenu', (event) => {
    event.preventDefault();
    contextMenu.style.display = 'block';
    contextMenu.style.left = `${event.clientX}px`;
    contextMenu.style.top = `${event.clientY}px`;
  });

  // Add icon menu item event listener
  addIconMenuItem.addEventListener('click', () => {
    createNewIcon();
    contextMenu.style.display = 'none';
  });

  // Trash can drop event listener
  trashCan.addEventListener('dragover', (event) => {
    event.preventDefault();
    trashCan.style.backgroundColor = '#c0392b';
  });

  trashCan.addEventListener('dragleave', () => {
    trashCan.style.backgroundColor = '#e74c3c';
  });

  trashCan.addEventListener('drop', (event) => {
    event.preventDefault();
    trashCan.style.backgroundColor = '#e74c3c';
    const draggedIcon = document.getElementById(event.dataTransfer.getData('text'));
    const iconName = draggedIcon.querySelector('.icon-name').textContent;

    // Show confirmation popup
    const isConfirmed = confirm(`Do you really want to delete "${iconName}"?`);
    if (isConfirmed) {
      draggedIcon.remove();
      deleteIconCookies(draggedIcon.id);
    }
  });

  // Drag and drop functions
  let activeIcon = null;

  function startDrag(event) {
    activeIcon = event.target;
    activeIcon.style.zIndex = 1;
    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', endDrag);
  }

  function drag(event) {
    if (activeIcon) {
      const newX = event.clientX - activeIcon.clientWidth / 2;
      const newY = event.clientY - activeIcon.clientHeight / 2;
      activeIcon.style.left = `${newX}px`;
      activeIcon.style.top = `${newY}px`;
    }
  }

  function endDrag() {
    if (activeIcon) {
      setCookie(`${activeIcon.id}-left`, activeIcon.style.left);
      setCookie(`${activeIcon.id}-top`, activeIcon.style.top);
      activeIcon.style.zIndex = 0;
      activeIcon = null;
      document.removeEventListener('mousemove', drag);
      document.removeEventListener('mouseup', endDrag);
    }
  }

  // Icon name edit functions
  let activeEditIconName = null;

  function startEdit(event) {
    activeEditIconName = event.target;
    activeEditIconName.contentEditable = true;
    activeEditIconName.focus();
    activeEditIconName.addEventListener('keydown', handleKeyDown);
  }

  function endEdit() {
    if (activeEditIconName) {
      setCookie(`${activeEditIconName.parentElement.id}-name`, activeEditIconName.textContent);
      activeEditIconName.contentEditable = false;
      activeEditIconName.removeEventListener('keydown', handleKeyDown);
      activeEditIconName = null;
    }
  }

  function handleKeyDown(event) {
    if (event.key === 'Enter') {
      event.preventDefault();
      endEdit();
    }
  }

  // Create a new icon
  function createNewIcon() {
    const newIcon = document.createElement('div');
    const newIconName = document.createElement('div');
    newIcon.classList.add('icon');
    newIcon.style.left = `${Math.random() * (window.innerWidth - 60)}px`;
    newIcon.style.top = `${Math.random() * (window.innerHeight - 60)}px`;
    newIconName.classList.add('icon-name');
    newIconName.contentEditable = true;
    newIconName.textContent = 'New Icon';
    newIcon.appendChild(newIconName);
    desktop.appendChild(newIcon);
    newIcon.addEventListener('mousedown', startDrag);
    newIconName.addEventListener('dblclick', startEdit);
    newIconName.addEventListener('blur', endEdit);
  }

  // Cookie functions
  function setCookie(name, value) {
    document.cookie = `${name}=${value}; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/`;
  }

  function getCookie(name) {
    const cookies = document.cookie.split('; ');
    for (const cookie of cookies) {
      const [cookieName, cookieValue] = cookie.split('=');
      if (cookieName === name) {
        return decodeURIComponent(cookieValue);
      }
    }
    return null;
  }

  // Function to delete icon cookies
  function deleteIconCookies(iconId) {
    setCookie(`${iconId}-left`, '', -1);
    setCookie(`${iconId}-top`, '', -1);
    setCookie(`${iconId}-name`, '', -1);
  }
</script>
</body>
</html>
